(()=>{"use strict";const e=(e,t)=>{let r=0,l=e,a=t;return{getLength:()=>l,getName:()=>a,hit:()=>{r++},getHits:()=>r,isSunk:()=>r>=l,reset:()=>{r=0}}},t=(t,r)=>{let l=t,a=(t=>{let r=t,l=Array(r).fill(null).map((()=>Array(r).fill(null))),a=Array(r).fill(!1).map((()=>Array(r).fill(!1))),n=Array(r).fill(!1).map((()=>Array(r).fill(!1))),i=[e(5,"carrier"),e(4,"battleship"),e(3,"cruiser"),e(3,"submarine"),e(2,"destroyer")];const s=(e,t,a,n)=>{let i=e.getLength();if(!((e,t,a,n)=>{if(a<0||a>r-1||n<0||n>r-1)return!1;if(1===t){if(a+e>r)return!1}else if(n+e>r)return!1;if(1===t){for(let t=-1;t<=e;t++)for(let e=-1;e<=1;e++)if(!(a+t<0||a+t>r-1||n+e<0||n+e>r-1)&&l[a+t][n+e])return!1}else for(let t=-1;t<=e;t++)for(let e=-1;e<=1;e++)if(!(a+e<0||a+e>r-1||n+t<0||n+t>r-1)&&l[a+e][n+t])return!1;return!0})(i,t,a,n))return!1;if(1===t)for(let t=0;t<i;t++)l[a+t][n]=e;else for(let t=0;t<i;t++)l[a][n+t]=e;return!0};return{getBoard:()=>l,getHits:()=>a,getMisses:()=>n,initializeBoard:()=>{let e=0;for(;e<5;){let t=i[e],r=Math.random()<.5?1:0,l=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());s(t,r,l,a)&&e++}},receiveAttack:(e,t)=>{e<0||e>r-1||t<0||t>r-1||(l[e][t]?(l[e][t].hit(),a[e][t]=!0):n[e][t]=!0)},allSunk:()=>{for(let e=0;e<i.length;e++)if(!i[e].isSunk())return!1;return!0},reset:()=>{l=Array(r).fill(null).map((()=>Array(r).fill(null))),a=Array(r).fill(!1).map((()=>Array(r).fill(!1))),n=Array(r).fill(!1).map((()=>Array(r).fill(!1)));for(let e=0;e<i.length;e++)i[e].reset()}}})(r),n=[];const i=(e,t,r)=>{((e,t)=>{for(let r=0;r<n.length;r++)if(n[r][0]===e&&n[r][1]===t)return!0;return!1})(e,t)||(n.push([e,t]),r.receiveAttack(e,t))};return{getName:()=>l,getGameboard:()=>a,getAttacks:()=>n,initializeGameboard:()=>{a.initializeBoard()},attack:i,randomAttack:e=>{let t=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());i(t,r,e)}}},r=document.getElementById("content"),l=document.getElementById("info"),a=document.querySelectorAll(".gameboard"),n=document.getElementById("start-btn"),i=document.getElementById("winner-container");i.style.display="none";const s=document.querySelector(".close"),o=document.getElementById("restart-btn");a.forEach((e=>{(e=>{for(let t=0;t<100;t++){let r=document.createElement("button");r.id=t,r.classList.add("cell"),e.appendChild(r)}})(e)}));const c=(e,t)=>{let r=t.getBoard(),l=t.getHits(),a=t.getMisses();for(let t=0;t<10;t++){let n=r[t],i=l[t],s=a[t];for(let r=0;r<10;r++){let l,a=n[r],o=i[r],c=s[r];l=0===t?r:Number(t.toString()+r.toString()),!0===o&&e[l].classList.add("hit"),!0===c&&e[l].classList.add("miss"),null!==a&&e[l].classList.add("active")}}},d=()=>{document.querySelectorAll(".cell").forEach((e=>{e.classList.contains("active")&&e.classList.remove("active"),e.classList.contains("hit")&&e.classList.remove("hit"),e.classList.contains("miss")&&e.classList.remove("miss")})),l.textContent="Make your shot";let e=document.querySelectorAll("#player .cell"),a=document.querySelectorAll("#opponent .cell"),n=t("player",10),s=t("opponent",10),o=((e,t)=>{let r;return{isGameOver:()=>e.getGameboard().allSunk()?(r=t.getName(),!0):!!t.getGameboard().allSunk()&&(r=e.getName(),!0),getWinner:()=>r}})(n,s);n.initializeGameboard(),s.initializeGameboard();let d=n.getGameboard(),m=s.getGameboard();c(e,d),c(a,m),a.forEach((t=>{t.addEventListener("click",(u=>{u.target.classList.contains("hit")||u.target.classList.contains("miss")||o.isGameOver()||(((e,t,a,n,s,o)=>{let c,d,m=e.id;if(1===m.length)c=0,d=Number(m);else{let e=m.split("");c=Number(e[0]),d=Number(e[1])}s.attack(c,d,t),a.randomAttack(n),(e=>{var t;e.isGameOver()&&(l.textContent="GAME OVER",t=e.getWinner(),document.getElementById("winner").textContent="player"===t?"You win":"The computer wins",i.style.display="block",r.style.opacity=.5)})(o)})(t,m,s,d,n,o),c(e,d),c(a,m))}))}))};n.addEventListener("click",d),s.addEventListener("click",(()=>{i.style.display="none",r.style.opacity=1})),o.addEventListener("click",(()=>{i.style.display="none",r.style.opacity=1,d()}))})();
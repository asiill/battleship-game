(()=>{"use strict";const e=(e,t)=>{let r=0,l=e,a=t;return{getLength:()=>l,getName:()=>a,hit:()=>{r++},getHits:()=>r,isSunk:()=>r>=l,reset:()=>{r=0}}},t=t=>{let r=t,l=Array(r).fill(null).map((()=>Array(r).fill(null))),a=Array(r).fill(!1).map((()=>Array(r).fill(!1))),i=Array(r).fill(!1).map((()=>Array(r).fill(!1))),n=[e(5,"carrier"),e(4,"battleship"),e(3,"cruiser"),e(3,"submarine"),e(2,"destroyer")];const s=(e,t,a,i)=>{let n=e.getLength();if(!((e,t,a,i)=>{if(a<0||a>r-1||i<0||i>r-1)return!1;if(1===t){if(a+e>r)return!1}else if(i+e>r)return!1;if(1===t){for(let t=-1;t<=e;t++)for(let e=-1;e<=1;e++)if(!(a+t<0||a+t>r-1||i+e<0||i+e>r-1)&&l[a+t][i+e])return!1}else for(let t=-1;t<=e;t++)for(let e=-1;e<=1;e++)if(!(a+e<0||a+e>r-1||i+t<0||i+t>r-1)&&l[a+e][i+t])return!1;return!0})(n,t,a,i))return!1;if(1===t)for(let t=0;t<n;t++)l[a+t][i]=e;else for(let t=0;t<n;t++)l[a][i+t]=e;return!0};return{getBoard:()=>l,getHits:()=>a,getMisses:()=>i,getShips:()=>n,placeShip:s,initializeBoard:()=>{let e=0;for(;e<5;){let t=n[e],l=Math.random()<.5?1:0,a=Math.floor(Math.random()*r),i=Math.floor(Math.random()*r);s(t,l,a,i)&&e++}},receiveAttack:(e,t)=>{if(!(e<0||e>r-1||t<0||t>r-1))return l[e][t]?(l[e][t].hit(),a[e][t]=!0,"hit"):(i[e][t]=!0,"miss")},allSunk:()=>{for(let e=0;e<n.length;e++)if(!n[e].isSunk())return!1;return!0},reset:()=>{l=Array(r).fill(null).map((()=>Array(r).fill(null))),a=Array(r).fill(!1).map((()=>Array(r).fill(!1))),i=Array(r).fill(!1).map((()=>Array(r).fill(!1)));for(let e=0;e<n.length;e++)n[e].reset()}}},r=document.getElementById("content"),l=document.getElementById("info"),a=document.querySelectorAll(".gameboard"),i=document.getElementById("start-btn"),n=document.getElementById("winner-container");n.style.display="none";const s=document.querySelector(".close"),o=document.getElementById("restart-btn");a.forEach((e=>{(e=>{for(let t=0;t<100;t++){let r=document.createElement("button");r.id=t,r.classList.add("cell"),e.appendChild(r)}})(e)}));const c=(e,t)=>{let r=t.getBoard(),l=t.getHits(),a=t.getMisses();for(let t=0;t<10;t++){let i=r[t],n=l[t],s=a[t];for(let r=0;r<10;r++){let l,a=i[r],o=n[r],c=s[r];l=0===t?r:Number(t.toString()+r.toString()),!0===o&&e[l].classList.add("hit"),!0===c&&e[l].classList.add("miss"),null!==a&&e[l].classList.add("active")}}},y=()=>{document.querySelectorAll(".cell").forEach((e=>{e.classList.contains("active")&&e.classList.remove("active"),e.classList.contains("hit")&&e.classList.remove("hit"),e.classList.contains("miss")&&e.classList.remove("miss")})),l.textContent="Make your move";let e=document.querySelectorAll("#player .cell"),a=document.querySelectorAll("#opponent .cell"),i=((e,r)=>{let l=r,a=t(e),i=[];return{getName:()=>l,getGameboard:()=>a,getAttacks:()=>i,initializeGameboard:()=>{a.initializeBoard()},attack:(e,t,r)=>{((e,t)=>{for(let r=0;r<i.length;r++)if(i[r][0]===e&&i[r][1]===t)return!0;return!1})(e,t)||(i.push([e,t]),r.receiveAttack(e,t))}}})(10,"player"),s=((e,r)=>{let l=e,a=r,i=t(l),n=[],s=null;const o=(e,t)=>{for(let r=0;r<n.length;r++)if(n[r][0]===e&&n[r][1]===t)return!0;return!1},c=(e,t,r)=>{n.push([e,t]),"hit"===r.receiveAttack(e,t)&&(s={x:e,y:t})},y=e=>{let t,r;do{t=Math.floor(Math.random()*l),r=Math.floor(Math.random()*l)}while(o(t,r));c(t,r,e)},d=(e,t)=>e>=0&&e<l&&t>=0&&t<l,u=(e,t)=>{const r=d(e,t),l=!o(e,t);return r&&l};return{getName:()=>a,getGameboard:()=>i,getAttacks:()=>n,initializeGameboard:()=>{i.initializeBoard()},attack:c,targetedAttack:e=>{if(s){let{x:t,y:r}=s;if(e.getBoard()[t][r].isSunk())s=null,y(e);else{let t=(e=>{let t,{x:r,y:l}=s,a=e.getHits(),i=e.getMisses();const n=d(r+1,l)&&a[r+1][l]||d(r-1,l)&&a[r-1][l]||d(r,l+1)&&i[r][l+1]&&d(r,l-1)&&i[r][l-1]||d(r,l+1)&&!d(r,l-1)&&i[r][l+1]||d(r,l-1)&&!d(r,l+1)&&i[r][l-1],o=d(r,l+1)&&!a[r][l+1]||d(r,l-1)&&!a[r][l-1]||d(r+1,l)&&i[r+1][l]&&d(r-1,l)&&i[r-1][l]||d(r+1,l)&&!d(r-1,l)&&i[r+1][l]||d(r-1,l)&&!d(r+1,l)&&i[r-1][l];return n?t=1:o?t=0:!n&&!o&&(t=Math.random()<.5?1:0),t})(e),r=(e=>{const t=[{x:s.x+1,y:s.y},{x:s.x-1,y:s.y},{x:s.x+2,y:s.y},{x:s.x-2,y:s.y},{x:s.x+3,y:s.y},{x:s.x-3,y:s.y},{x:s.x+4,y:s.y},{x:s.x-4,y:s.y}],r=[{x:s.x,y:s.y+1},{x:s.x,y:s.y-1},{x:s.x,y:s.y+2},{x:s.x,y:s.y-2},{x:s.x,y:s.y+3},{x:s.x,y:s.y-3},{x:s.x,y:s.y+4},{x:s.x,y:s.y-4}];if(1===e){for(const e of t)if(u(e.x,e.y))return{x:e.x,y:e.y}}else for(const e of r)if(u(e.x,e.y))return{x:e.x,y:e.y};return null})(t);r?c(r.x,r.y,e):y(e)}}else y(e)}}})(10,"opponent"),o=((e,t)=>{let r;return{isGameOver:()=>e.getGameboard().allSunk()?(r=t.getName(),!0):!!t.getGameboard().allSunk()&&(r=e.getName(),!0),getWinner:()=>r}})(i,s);i.initializeGameboard(),s.initializeGameboard();let y=i.getGameboard(),d=s.getGameboard();c(e,y),c(a,d);const u=t=>{t.target.classList.contains("hit")||t.target.classList.contains("miss")||o.isGameOver()||(((e,t,a,i,s,o)=>{let c,y,d=e.id;if(1===d.length)c=0,y=Number(d);else{let e=d.split("");c=Number(e[0]),y=Number(e[1])}s.attack(c,y,t),a.targetedAttack(i),(e=>{var t;e.isGameOver()&&(l.textContent="GAME OVER",t=e.getWinner(),document.getElementById("winner").textContent="player"===t?"You win":"The computer wins",n.style.display="block",r.style.opacity=.5)})(o)})(t.target,d,s,y,i,o),c(e,y),c(a,d))};a.forEach((e=>{e.addEventListener("click",u)}))};i.addEventListener("click",y),s.addEventListener("click",(()=>{n.style.display="none",r.style.opacity=1})),o.addEventListener("click",(()=>{n.style.display="none",r.style.opacity=1,y()}))})();